substitutions:
  # Standard colors
  color_bg: "0xFFFFFF"
  color_accent: "0x000000"
  color_text: "0x000000"
  color_subtext: "0x888888"

globals:
  - id: is_speaking
    type: bool
    restore_value: no
    initial_value: "false"
  - id: is_listening
    type: bool
    restore_value: no
    initial_value: "false"

spi:
  id: spi_bus
  clk_pin: GPIO4
  mosi_pin: GPIO2

font:
  - file: "gfonts://Roboto"
    id: font_normal
    size: 20
  - file: "gfonts://Roboto"
    id: font_small
    size: 14

text_sensor:
  - platform: template
    name: "User Text"
    id: user_text
    update_interval: never
  - platform: template
    name: "Bot Response"
    id: bot_text
    update_interval: never

display:
  - platform: ili9xxx
    model: GC9A01A
    id: cosmo_display
    spi_id: spi_bus
    dimensions:
      height: 240
      width: 240
    cs_pin: GPIO5
    dc_pin: GPIO47
    reset_pin: GPIO38
    invert_colors: false
    update_interval: 0.1s # Faster update for animation
    lambda: |-
      it.fill(Color(0xFFFFFF));
      
      // Eyes (Black)
      it.filled_circle(80, 80, 20, Color(0x000000));
      it.filled_circle(160, 80, 20, Color(0x000000));
      
      // Mouth Area (Center ~ 120, 140)
      int center_x = 120;
      int center_y = 140;
      int width = 80;
      
      // Ears (Listening Indicators)
      if (id(is_listening)) {
          // Left Ear
          it.filled_circle(0, 120, 15, Color(0x000000));
          // Right Ear
          it.filled_circle(240, 120, 15, Color(0x000000));
      }

      // Mouth Animation
      if (id(is_speaking)) {
         // Speaking: Blinking square
         // Blink every 200ms
         if ((millis() / 200) % 2 == 0) {
            int square_size = 50;
            it.filled_rectangle(center_x - (square_size / 2), center_y - (square_size / 2), square_size, square_size, Color(0x000000));
         }
      } else {
         // Not speaking: Horizontal bar (Closed mouth)
         it.filled_rectangle(center_x - (width / 2), center_y - 3, width, 6, Color(0x000000));
      }
