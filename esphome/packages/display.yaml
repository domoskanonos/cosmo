substitutions:
  # Standard colors
  color_bg: "0xFFFFFF"
  color_accent: "0x000000"
  color_text: "0x000000"
  color_subtext: "0x888888"

globals:
  - id: is_speaking
    type: bool
    restore_value: no
    initial_value: "false"
  - id: is_listening
    type: bool
    restore_value: no
  - id: is_ready
    type: bool
    restore_value: no
    initial_value: "false"

spi:
  id: spi_bus
  clk_pin: GPIO4
  mosi_pin: GPIO2

font:
  - file: "gfonts://Roboto"
    id: font_large
    size: 40

text_sensor:
  - platform: template
    name: "User Text"
    id: user_text
    update_interval: never
  - platform: template
    name: "Bot Response"
    id: bot_text
    update_interval: never

display:
  - platform: ili9xxx
    model: GC9A01A
    id: cosmo_display
    spi_id: spi_bus
    dimensions:
      height: 240
      width: 240
    cs_pin: GPIO5
    dc_pin: GPIO47
    reset_pin: GPIO38
    invert_colors: false
    update_interval: 0.1s # Faster update for animation
    lambda: |-
      it.fill(Color(0xFFFFFF));
      
      // Boot Screen
      if (!id(is_ready)) {
          it.printf(120, 120, id(font_large), Color(0x000000), TextAlign::CENTER, "Nabu");
          return;
      }
      
      // Eyes (Black)
      it.filled_circle(80, 80, 20, Color(0x000000));
      it.filled_circle(160, 80, 20, Color(0x000000));
      
      // Mouth Area (Center ~ 120, 140)
      int center_x = 120;
      int center_y = 140;
      int width = 80;
      
      // Ears (Listening Indicators) - Curved for Round Display
      if (id(is_listening)) {
          // Left Ear - Arc segment simulation
          it.filled_circle(0, 120, 20, Color(0x000000));
          // Right Ear - Arc segment simulation 
          it.filled_circle(240, 120, 20, Color(0x000000));
      }

      // Mouth Animation linked to Global State (Manual triggers)
      if (id(is_speaking)) {
         // Speaking: Animated "Pill" Shape
         // Vary width based on time to simulate talking
         int anim_width = 40 + (int)(20 * sin(millis() / 100.0));
         int anim_height = 20 + (int)(10 * cos(millis() / 100.0));
         
         // Draw centered rounded rect (simulated with rect + circles if needed, or just rect for speed)
         it.filled_rectangle(center_x - (anim_width / 2), center_y - (anim_height / 2), anim_width, anim_height, Color(0x000000));
      } else {
         // Not speaking: Small horizontal pill (Closed mouth)
         it.filled_rectangle(center_x - 15, center_y - 5, 30, 10, Color(0x000000)); 
      }
