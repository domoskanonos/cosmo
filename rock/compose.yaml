services:
  # Das Gehirn: LLM und Spracherkennung (STT)
  local-ai:
    image: docker.io/localai/localai:latest-core-arm64
    container_name: local-ai
    restart: always
    environment:
      - THREADS=4
      - MODELS_PATH=/build/models
      - DEBUG=true
    ports:
      - "8080:8080"
    volumes:
      - ./models:/build/models:z
    networks:
      - alexa-net

  # Die Stimme: Text-to-Speech (TTS)
  piper:
    image: docker.io/rhasspy/wyoming-piper
    container_name: wyoming-piper
    restart: always
    ports:
      - "10200:10200"
    volumes:
      - ./piper-data:/data:z
    command: --voice de_DE-thorsten-high
    networks:
      - alexa-net

  # Das Ohr: Wake Word & Voice Activity Detection (VAD)
  satellite:
    image: docker.io/rhasspy/wyoming-satellite
    container_name: wyoming-satellite
    restart: always
    # Zugriff auf die Soundkarte des Rock 5
    devices:
      - "/dev/snd:/dev/snd"
    ports:
      - "10420:10420"
    command: 
      - --name
      - "Rock5-Alexa"
      - --uri
      - "tcp://0.0.0.0:10420"
      - --mic-command
      - "arecord -D hw:0,0 -r 16000 -c 1 -f S16_LE -t raw"
      - --snd-command
      - "aplay -D hw:0,0 -r 22050 -c 1 -f S16_LE -t raw"
      - --wake-word
      - "openwakeword"
      - --vad
    networks:
      - alexa-net

networks:
  alexa-net:
    driver: bridge